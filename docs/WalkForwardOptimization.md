# Walk-Forward Optimization

Walk-Forward Optimizations finds an optimal set of parameters by testing an "In-Sample" (IS) interval of data and applies them to an "Out-of-Sample" (OOS) section of data. The OOS data is subsequently included in a new IS interval, whose optimized parameters are applied to another chunk of OOS data, and so on. The process is repeated over usually more than 2 intervals. 

The combined results of the OOS backtests provides a far more realistic simulation of what could have been achieved trading an optimized Strategy than when compared to the backtest results of a Standard Optimization. 

> **Important Programming Note!**  
> When optimization parameters are used for indicators, C# strategy authors must add/override the `NewWFOInterval()` method to properly backtest with the set of parameter values found by a Walk-Forward Optimization. This occurs automatically for Building Block strategies, which can be used as examples. *Background:* Indicators are usually created in `Initialize()`, which is called only once for each symbol. A backtest that uses WFO parameters, however, will change parameters at various intervals and indicators need to be regenerated at these times in `NewWFOInterval()`. In general, any local-scope variable that uses an optimization parameter should re-assign its parameter in `NewWFOInterval()`. 

You can use WFO to establish if a walk-forward trading methodology hypothetically improves your trading system's performance. It's even possible that the opposite occurs, which may indicate that the Strategy is not robust and/or that the parameters are overfitted. Also, since the WFO process chooses parameters that result in maximizing (or minimizing) a specified performance metric, it may pick peaks on an optimization surface that you may not have actually selected as the best choice for a stable system. 

---
## Setting up to Walk-Forward

Select the **Parameters** to include in the optimization by checking them in the **Optimization Settings** > **Standard** tab. C# authors should override `NewWFOInterval()` (see **Important Programming Note** above). Then select the **Walk-Forward** tab to continue setting up the following: 

### Number of Walk-Forward Intervals
This controls the number of walk-forward intervals that are performed. In general, use more intervals when more data are available, and fewer intervals for lower trading frequencies. As a rule of thumb for end-of-day strategies, choose one interval per year of data in the test range.

### Out-of-sample Data %

This sets the percentage of data in each interval reserved for the OOS backtest using the optimized parameters found in the same interval's In-Sample optimization. For practical reasons, the value is constrained to be between 10% and 50%. In an expanding window (see Window Type below), the percentage corresponds to the amount of OOS data for the first interval only.

## Using the WFO Data Range Wizard
Click the **WFO Data Range Wizard** button to launch the WFO Data Range Wizard dialog that lets you establish WFO Window Ranges in units of days, weeks, months, or years. Upon completion, WL8 will set the correct Out-of-Sample Data % and the required Data Range with a Most Recent history, load the required data, and display the WFO Intervals based on the values you entered in the Wizard.

### Window Type

- **Sliding Window** - the In-Sample range is a fixed number of bars that slides forward for each interval.  See **Bar Heat Map** below for illustration. 
 
- **Expanding Window** - the In-Sample range is anchored to the beginning of the full test range, growing larger for each interval.  See **Bar Heat Map** below for illustration. 

### Walk-Forward Target Metric
Parameters that produce the *Highest* or *Lowest* selected metric are used for the OOS backtests.  The metrics available are determined by the **ScoreCard**.

### Pre-Live Optimization Run

When enabled, this option results in a final optimization pass that considers the most current range of data loaded. The intention of the Pre-Live Run is to produce current optimized parameter values tuned to the most recent data and suitable for live trading. Signals generated by WFO runs when Pre-Live is enabled will use the parameter values derived by the Pre-Live optimization run.

---
## WFO Results

**Run an OOS Backtest using WFO Parameters**  
Upon WFO completion this button runs a backtest that begins with the first interval's OOS range and applies the optimized Parameters at the start of each of OOS interval.  Results are shown in the Backtest Results tab's [Perfomance Visualizers](PerformanceVisualizers).

%{color:blue}**Note!**%  
>Positions that are open at the end of an Out-of-sample interval may be exited in a subsequent OOS interval using a different [optimum] set of parameters.

### Parameter History (WFO)
The history view shows you the optimized Parameter values for each WFO interval.
 
### Bar Heat Map (WFO)  
The heat map illustrates the In-Sample and Out-of-Sample APR% performance for each interval. 

*Sliding Window*  
![WFO Sliding Window](https://www.wealth-lab.com/Images/WLHelp/WFO_Sliding.png)

*Expanding Window*  
![WFO Expanding Window](https://www.wealth-lab.com/Images/WLHelp/WFO_Expanding.png)

### Tabular (WFO)
This view provides the Parameter combination and Scorecard metrics for the optimum backtest (based on the selected metric) for each IS and OOS interval. Click the column headers to sort the results. 

**WFO Efficiency (WFE) %**  
Wealth-Lab uses Robert Pardo's definition of WFE in *The Evaluation and Optimization of Trading Strategies* to be the annualized profit of the OOS test divided by that of the IS (optimized) test, or APoos / APopt. A WFE above 50% is generally viewed as a robust strategy - one that is expected to generate profit in different market conditions consistent with backtest results. WFE values well below 50% may indicate a non-robust, over-fitted Strategy that is more likely to lose money.

### Other Actions
A number of actions are available in the right-click menu.  **Sort by Parameter Values** is a "deep sort" by that sorts the first Parameter column, and then the second, and so on. 

*Right click menu options*   
![WFO Expanding Window](https://www.wealth-lab.com/Images/WLHelp/WFO_ContextMenu.png)

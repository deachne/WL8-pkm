# Chart Patterns Extension Preferences

These settings let you tune the algorithms that power the rules detecting Classic Chart Patterns. Examing the rules in the **ChartPatterns.txt** file in the [WL8 Data Folder](action:DataFolder) can help understand how these Preferences apply. For example, one of the Head & Shoulders Top rules states:
```
PeakTroughCompare Peak(0) Near Peak(2) NoDraw
```
In plain English, this translates to: "The peak that defines the first shoulder is near the peak that defines the second." The **near** operator compares the distance of the two peaks, using the **Near** Preference in the **Peak/Trough Comparisons** section. If the percentage difference of the two peaks is within this value, the rule resolves to true.

Loosening these Preferences can cause more Classic Chart Patterns to get detected, but possibly at the price of overall quality of the detected patterns.
## Pattern Engine Passes
The Classic Chart Pattern [Event Provider](EventProvidersTab) and [Condition Building Block](BuildingBlocks) use a **ChartPatternEngine** class to detect patterns. The ChartPatternEngine runs through a number of passes, and each pass widens the search window slightly. This results in more patterns across varying time frames to be detected. You can control the number of passes the ChartPatternEngine takes in this section, the default being 5. Increasing this value will result in more longer-term patterns being detected, at the expense of processing time.
## Peak/Trough Calculation
The Extension uses the **PeakTroughCalculator** class to generate Peaks and Troughs for Classic Chart Pattern detection. It bases the Peak/Troughs on **ATRPercent** moves. This section lets you change the ATRPercent **period** (default 10) and the required **reversal amount** (default of the Pass number plus 1 ATRPercent). Increasing the reversal amount for each Pass results in longer term Peaks/Troughs being detected as the Passes increase.
## Peak/Trough Comparisons
Several rules allow you to compare two Peaks/Troughs, with the possible options of:

 - Very Near, Near, Not Far, Far, Above, Below

These settings let you establish the percentage differences that define each of these levels. For example, the **Very Near** setting has a default of 0.25. This means that if the percentage differernt of the first Peak value and the second is 0.25% or less they are considered **very near** each other.

The **Above/Below** setting lets you control how far apart Peak/Troughs must be in order to be even considered to be above or below each other. 

## Trendline Generation
Some rules use **Trendlines** which are generated by the PeakTroughCalculator, either based on ther Peaks (upper Trendlines) or the Troughs (lower Trendlines).

The first two options here control whether the **number of Peaks/Troughs** used to generate the Trendlines are based on either the current Pass number plus a value, or are just a fixed number. Leaving the first option selected causes the resulting Trendlines to be based on more data points as the Passes increase, and thus encompass a wider range of data.

The second two options are releated to how close a fit the Trendlines must have in order to be retained. This is called the **Trendline Deviation**. You can either set the minimum Deviation to be less than the current Pass number multipled by a certain value, or to simply be less than a specified fixed value. The former option allows more Trendlines to be accepted, since the  minimum Deviation required is increasing as the Pass number increases.
## PriceGrid Window Size
Classic Chart Patterns can include **Grid-Based Patterns** that are managed in the [PriceGrid Editor](PriceGridEditor). During the first Pass of processing, the ChartPatternEngine matches windows of data that are the exact same dimension as the PriceGrid being tested. In subsequent passes, the window size increases, allowing larger patterns to get detected. This setting controls how much the **window size increases** each subsequent Pass (default is 25%.)
## Trend Determination
Some Classic Chart Patterns include rules that test whether or not the market is trending at the point the pattern is detected. The Extension uses the **TrendMeter** [Indicator](Indicators) to determine if prices are trending. For the first Pass of processing, a period of 30 is used for TrendMeter. For subsequent Passes, the setting here controls how much the **TrendMeter period increases** (default of 10 per Pass.)

The remaining settings default thresholds for trends. Prices are considered the be trending up when the TrendMeter value is above the **Up Trend value** (default 70), and down when it is below the **Down Trend value** (default -70.)  For prices to be considered not trending, the absolute value of the TrendMeter indicator must be less than the **Neutral Trend value** (default 70.)
# TrendLine Class

**Namespace:** WealthLab.Indicators  
**Parent:** Object

The `TrendLine` class represents a trend line within a time series data source, expressing two points via indices and values. It is typically generated by the `PeakTroughCalculator` to analyze price trends and patterns.

## Constructors

### TrendLine(List<PeakTrough>)
```csharp
public TrendLine(List<PeakTrough> pts)
```
Creates a `TrendLine` instance based on a list of `PeakTrough` points using linear regression.

**Requirements:**
- Minimum of 4 `PeakTrough` points required
- Used by `PeakTroughCalculator` in `GetLowerTrendLine` and `GetUpperTrendLine` methods

**Example:**
```csharp
var peakTroughs = PeakTroughCalculator.Calculate(prices);
var trendLine = new TrendLine(peakTroughs);
```

### TrendLine(Index, Value, Index, Value)
```csharp
public TrendLine(int idx1, double val1, int idx2, double val2)
```
Creates a `TrendLine` based on specific start and end indices and values.

**Parameters:**
- `idx1`: First point's index
- `val1`: First point's Y-axis value
- `idx2`: Second point's index
- `val2`: Second point's Y-axis value

**Example:**
```csharp
var trendLine = new TrendLine(10, 50.5, 20, 75.3);
```

## Properties

### Deviation
```csharp
public double Deviation
```
Represents the average distance (as a percentage) of peak/trough points from the trend line.

**Characteristics:**
- Calculated using linear regression
- Lower deviation indicates a closer fit to the points
- Helps assess trend line reliability

### Index1
```csharp
public int Index1
```
The index of the first (left) point of the trend line in the underlying source data.

### Index2
```csharp
public int Index2
```
The index of the second (right) point of the trend line in the underlying source data.

### Value1
```csharp
public double Value1
```
The Y-axis value of the first (left) point of the trend line.

### Value2
```csharp
public double Value2
```
The Y-axis value of the second (right) point of the trend line.

### IsFalling
```csharp
public bool IsFalling
```
Returns `true` if the trend line's starting point is less than its ending point.

### IsRising
```csharp
public bool IsRising
```
Returns `true` if the trend line's starting point is greater than its ending point.

## Methods

### ExtendTo
```csharp
public double ExtendTo(int idx, bool useLog = false)
```
Extends the trend line to an arbitrary point on the X-axis and returns its corresponding Y-axis value.

**Parameters:**
- `idx`: Target index to extend the trend line
- `useLog`: Optional parameter to use logarithmic scaling (default is `false`)

**Returns:** Y-axis value at the specified index

**Example:**
```csharp
// Extend trend line to a specific index
double extendedValue = trendLine.ExtendTo(25);

// Extend with logarithmic scaling
double logExtendedValue = trendLine.ExtendTo(25, true);
```

## Usage Examples

### Trend Line Analysis
```csharp
public class TrendAnalyzer
{
    public void AnalyzePriceTrend(TimeSeries prices)
    {
        // Calculate peak and trough points
        var peakTroughs = PeakTroughCalculator.Calculate(prices);
        
        // Create trend lines
        var upperTrendLine = new TrendLine(peakTroughs.Where(pt => pt.Type == PeakTroughType.Peak).ToList());
        var lowerTrendLine = new TrendLine(peakTroughs.Where(pt => pt.Type == PeakTroughType.Trough).ToList());
        
        // Analyze trend characteristics
        Console.WriteLine($"Upper Trend Line Deviation: {upperTrendLine.Deviation}%");
        Console.WriteLine($"Is Upper Trend Rising: {upperTrendLine.IsRising}");
        
        Console.WriteLine($"Lower Trend Line Deviation: {lowerTrendLine.Deviation}%");
        Console.WriteLine($"Is Lower Trend Falling: {lowerTrendLine.IsFalling}");
        
        // Extend trend lines
        double upperExtendedValue = upperTrendLine.ExtendTo(prices.Count - 1);
        double lowerExtendedValue = lowerTrendLine.ExtendTo(prices.Count - 1);
    }
}
```

### Trading Strategy with Trend Lines
```csharp
public class TrendLineTradingStrategy : UserStrategyBase
{
    public override void Execute(BarHistory bars, int idx)
    {
        // Calculate peak and trough points
        var peakTroughs = PeakTroughCalculator.Calculate(bars.Close);
        
        // Create upper and lower trend lines
        var upperTrendLine = new TrendLine(
            peakTroughs.Where(pt => pt.Type == PeakTroughType.Peak).ToList()
        );
        var lowerTrendLine = new TrendLine(
            peakTroughs.Where(pt => pt.Type == PeakTroughType.Trough).ToList()
        );
        
        // Trading logic based on trend line characteristics
        if (upperTrendLine.Deviation < 5 && upperTrendLine.IsFalling)
        {
            // Potential bearish trend
            Sell();
        }
        
        if (lowerTrendLine.Deviation < 5 && lowerTrendLine.IsRising)
        {
            // Potential bullish trend
            Buy();
        }
    }
}
```

## Best Practices

1. **Trend Line Interpretation**
   - Consider `Deviation` when assessing trend line reliability
   - Use multiple time frames for comprehensive analysis
   - Combine trend line analysis with other technical indicators

2. **Performance Considerations**
   - Minimize unnecessary trend line calculations
   - Cache trend line results when possible
   - Use efficient peak and trough detection methods

3. **Trading Strategies**
   - Don't rely solely on trend lines
   - Implement robust risk management
   - Validate trend line signals across different market conditions

## Notes

- Powerful tool for technical trend analysis
- Supports both linear and logarithmic trend line extensions
- Useful in developing trend-following trading strategies
- Provides insights into price movement patterns 
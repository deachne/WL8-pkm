# Position Class

**Namespace:** WealthLab.Backtest  
**Parent:** Object

The `Position` class represents a long or short position generated by the backtester, providing detailed information about trade execution, performance, and metrics.

## Core Properties

### Bars
```csharp
public BarHistory Bars
```
Returns the `BarHistory` instance that this Position was based on. Useful for determining which symbol a particular Position was established on, especially in multi-symbol strategies.

### BarsHeld
```csharp
public int BarsHeld
```
Returns the number of bars the position was held. If the Position is still active, returns the total number of bars held as of the last chart bar.

### IsOpen
```csharp
public bool IsOpen
```
Returns `true` if the Position is currently open (not yet exited).

### PositionType
```csharp
public PositionType PositionType
```
Returns the position type, with possible values:
- `PositionType.Long`
- `PositionType.Short`

## Entry Details

### EntryBar
```csharp
public int EntryBar
```
Returns the bar number where the Position entry occurred.

### EntryDate
```csharp
public DateTime EntryDate
```
Returns the DateTime the Position was entered.

### EntryPrice
```csharp
public double EntryPrice
```
Returns the price at which the Position was entered.

### EntryOrderType
```csharp
public OrderType EntryOrderType
```
Returns the type of order used to establish the Position:
- `OrderType.Market`
- `OrderType.Limit`
- `OrderType.Stop`
- `OrderType.MarketClose`
- `OrderType.LimitMove`
- `OrderType.FixedPrice`

### BasisPrice
```csharp
public double BasisPrice
```
The price used to establish the Position's share size. For market orders, typically the previous bar's closing price, but configurable in Strategy Settings.

## Exit Details

### ExitBar
```csharp
public int ExitBar
```
Returns the bar number where the Position exit occurred. Returns -1 if the Position is still open.

### ExitDate
```csharp
public DateTime ExitDate
```
Returns the DateTime the Position was exited. Returns `DateTime.MaxValue` if the Position is still open.

### ExitPrice
```csharp
public double ExitPrice
```
Returns the price at which the Position was exited. Returns zero if the Position is still open.

### ExitOrderType
```csharp
public OrderType ExitOrderType
```
Returns the type of order used to close the Position:
- `OrderType.Market`
- `OrderType.Limit`
- `OrderType.Stop`
- `OrderType.MarketClose`
- `OrderType.FixedPrice`

## Performance Metrics

### Profit
```csharp
public double Profit
```
Returns the Position's profit with commissions deducted. Primarily for Performance Visualizers.

### ProfitPercent
```csharp
public double ProfitPercent
```
Returns the percentage profit in the base currency, with commissions deducted.

### MAE (Maximum Adverse Excursion)
```csharp
public double MAE
public double MAEPercent
```
Returns the largest intraday loss experienced by the Position, with commissions applied.

### MFE (Maximum Favorable Excursion)
```csharp
public double MFE
public double MFEPercent
```
Returns the highest intraday profit experienced by the Position, with commissions applied.

## Commission and Cost

### Commission
```csharp
public double Commission
```
Returns the total commission (entry plus exit) in the base currency.

### CostBasis
```csharp
public double CostBasis
```
Returns the cost basis in the base currency, calculated as EntryPrice multiplied by Quantity.

## Additional Methods and Properties

### DaysInPosition
```csharp
public int DaysInPosition(int idx, bool countByLastBarOfDay)
```
Returns the number of trading days passed since establishing the Position when using intraday data.

### GetMetric
```csharp
public double GetMetric(string metricName)
```
Returns the value of a Position Metric, either built-in or custom.

### SetMetric
```csharp
public void SetMetric(string metric, double value)
```
Adds a custom Position Metric.

## Usage Examples

```csharp
// Analyzing a Position's performance
public void AnalyzePosition(Position pos)
{
    if (pos.IsOpen)
    {
        Console.WriteLine("Position is still active");
        return;
    }

    Console.WriteLine($"Profit: {pos.Profit:C2}");
    Console.WriteLine($"Profit %: {pos.ProfitPercent:P2}");
    Console.WriteLine($"Maximum Adverse Excursion: {pos.MAE:C2}");
    Console.WriteLine($"Days Held: {pos.BarsHeld}");
}
```

## Best Practices

1. Use Position properties primarily in Performance Visualizers
2. For strategy development, use methods like `ProfitAsOf` during backtesting
3. Be aware of multi-currency backtest implications
4. Leverage custom metrics for advanced analysis

## Notes

- Intended for performance analysis and visualization
- Provides comprehensive trade execution and performance details
- Supports both equity and futures trading modes 